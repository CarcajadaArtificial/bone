//   ___ _
//  / __(_)______
//  \__ \ |_ / -_)
//  |___/_/__\___|
//
// =====================================================================================================
@use '../lib/sass-door' as *;
@use 'sass:map';
@use 'sass:math';

// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
// prettier-ignore
$scales: (
  double-octave:      4,
  pi:                 3.14159265359,
  major-twelfth:      3,
  major-eleventh:     2.66666666667,
  major-tenth:        2.5,
  octave:             2,
  major-seventh:      1.875,
  minor-seventh:      1.77777777778,
  major-sixth:        1.66666666667,
  golden-ratio:       1.61803398874,
  minor-sixth:        1.6,
  perfect-fifth:      1.5,
  augmented-fourth:   1.41421,
  perfect-fourth:     1.33333333333,
  major-third:        1.25,
  minor-third:        1.2,
  major-second:       1.125,
  minor-second:       1.06666666667,
) !default;

// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
///
/// @group sizes
///
$line-height-unit: 1.5rem;

// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
///
/// @group sizes
///
@mixin build-sizes($from: 0, $through: 0, $base: 1rem, $ratio: 1) {
  @for $i from $from through $through {
    $font-size: modular-scale($i, $base, $ratio);
    --fs#{$i}: #{$font-size};
    --lh#{$i}: #{closest-line-height($font-size)};
  }
}

// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
///
/// @group sizes
///
@function modular-scale($value: 0, $base: 1rem, $ratio: 1) {
  $result: $base;
  $ratio: if(check-individual-type($ratio, 'unitless', true), $ratio, map.get($scales, $ratio));
  @if $value > 0 {
    @for $i from 1 through $value {
      $result: $result * $ratio;
    }
  } @else if $value < 0 {
    $value: $value * -1;
    @for $i from 0 through $value {
      $result: math.div($result, $ratio);
    }
  }
  @return $result;
}

// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
///
/// @group sizes
///
@function modular-scale-range($from: 0, $through: 0, $base: 1rem, $ratio: 1) {
  $range: ();
  @for $i from $from through $through {
    $ms: modular-scale($i, $base, $ratio);
    $range: append($range, $ms);
  }
  @return $range;
}

@function closest-line-height($font-size) {
  $result: $line-height-unit;

  @while $result < ($font-size * 1.12) {
    $result: $result + $line-height-unit;
  }

  @return $result;
}
